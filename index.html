<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>جستجوی اطلاعات دانشجو</title>
  <style>
    body {
      font-family: sans-serif;
      direction: rtl;
      text-align: right;
      padding: 30px;
      background: #eef2f3;
    }

    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 10px 0;
    }

    #result {
      margin-top: 20px;
    }

    .card {
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid #ccc;
      padding: 15px 20px;
      margin-bottom: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .field {
      margin-bottom: 8px;
    }

    .label {
      font-weight: bold;
      color: #444;
    }
  </style>
</head>
<body>
  <h2>🔍 جستجوی اطلاعات دانشجو</h2>
  <label>کد دانشجویی:</label><br>
  <input type="text" id="stdInput" placeholder="مثلاً 123456">
  <button onclick="search()">جستجو</button>
  <div id="result">اطلاعات نمایش داده خواهد شد...</div>

  <script>
    async function search() {
      const std = document.getElementById("stdInput").value.trim();
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "<em>⏳ در حال جستجو...</em>";

      const csvUrl = "https://docs.google.com/spreadsheets/d/1zkq0V8LPNagEk5Z3EkdrXz4uJuVUEijIvQ8xErbqCgE/export?format=csv";

      try {
        const response = await fetch(csvUrl);
        const text = await response.text();
        const rows = text.split(/\r?\n/).map(row => row.split(","));

        const headers = rows[0].map(h => h.trim());
        const data = rows.slice(1).filter(row => row.length === headers.length);

        const labelMap = {
          "std": "کد دانشجویی",
          "name": "نام",
          "fname": "نام خانوادگی",
          "dars": "درس",
          "code": "کد درس",
          "tarikh": "تاریخ",
          "saat": "ساعت",
          "makan": "مکان"
        };

        const matches = data.filter(row => row[0].trim() === std);

        if (matches.length > 0) {
          resultDiv.innerHTML = "";
          matches.forEach(row => {
            const card = document.createElement("div");
            card.className = "card";

            headers.forEach((header, i) => {
              const label = labelMap[header.trim()] || header.trim();
              const value = row[i] ? row[i].trim() : "";
              const field = `<div class="field"><span class="label">${label}:</span> ${value}</div>`;
              card.innerHTML += field;
            });

            resultDiv.appendChild(card);
          });
        } else {
          resultDiv.innerHTML = "❌ اطلاعاتی برای این کد یافت نشد.";
        }
      } catch (e) {
        resultDiv.innerHTML = "⚠️ خطا در دریافت اطلاعات. لطفاً دوباره تلاش کنید.";
        console.error(e);
      }
    }
  </script>
</body>
</html>
